<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        label {
            display: block;
            margin-top: 10px;
        }

        button {
            margin-top: 10px;
        }

        #invoice {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
        }

        .delete-btn {
            cursor: pointer;
            color: red;
            font-weight: bold;
            margin-left: 10px;
        }
    </style>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>
    <h1>Invoice App</h1>
    <label for="clientName">Client Name:</label>
    <input type="text" id="clientName">

    <label for="itemName">Item/Task Name:</label>
    <input type="text" id="itemName">

    <label for="hourlyRate">Hourly Rate ($):</label>
    <input type="number" id="hourlyRate" min="0.01" step="0.01" value="0.00">

    <label for="hoursWorked">Hours Worked:</label>
    <input type="number" id="hoursWorked" min="0" value="0">

    <label for="notes">Details:</label>
    <textarea id="notes"></textarea>

    <button onclick="addItem()">Add Item</button>

    <div id="invoice">
        <h2>Invoice</h2>
        <ul id="invoiceItems"></ul>
        <p>Total: $<span id="total">0.00</span></p>
        <button onclick="downloadInvoice()">Download Invoice</button>
    </div>

    <script>
        let items = [];
        let total = 0;

        function addItem() {
            const clientName = document.getElementById("clientName").value;
            const itemName = document.getElementById("itemName").value;
            const hourlyRate = parseFloat(document.getElementById("hourlyRate").value);
            const hoursWorked = parseFloat(document.getElementById("hoursWorked").value);
            const notes = document.getElementById("notes").value;

            const itemTotal = hourlyRate * hoursWorked;

            items.push({ id: Date.now(), clientName, itemName, hourlyRate, hoursWorked, itemTotal, notes });
            total += itemTotal;

            updateInvoice();
        }

        function deleteItem(itemId) {
            const itemIndex = items.findIndex(item => item.id === itemId);
            if (itemIndex !== -1) {
                total -= items[itemIndex].itemTotal;
                items.splice(itemIndex, 1);
                updateInvoice();
            }
        }

        function updateInvoice() {
            const invoiceItems = document.getElementById("invoiceItems");
            const totalSpan = document.getElementById("total");

            invoiceItems.innerHTML = "";
            items.forEach(item => {
                const li = document.createElement("li");
                li.textContent = `${item.itemName} - $${item.itemTotal.toFixed(2)} | Hours: ${item.hoursWorked} | Notes: ${item.notes}`;
                
                const deleteBtn = document.createElement("span");
                deleteBtn.className = "delete-btn";
                deleteBtn.textContent = "Delete";
                deleteBtn.onclick = () => deleteItem(item.id);

                li.appendChild(deleteBtn);
                invoiceItems.appendChild(li);
            });

            totalSpan.textContent = total.toFixed(2);
        }

        async function downloadInvoice() {
            // Use html2canvas to capture the content of the #invoice element
            const canvas = await html2canvas(document.getElementById("invoice"));

            // Convert the canvas to a data URL representing a PNG image
            const image = canvas.toDataURL("image/png");

            // Create a download link for the PNG image
            const a = document.createElement("a");
            a.href = image;
            a.download = "hourly_invoice.png";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>
</body>
</html>
